(function(n,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("three")):typeof define=="function"&&define.amd?define(["exports","three"],r):(n=typeof globalThis<"u"?globalThis:n||self,r(n.locar={},n.THREE))})(this,function(n,r){"use strict";var S=n=>{throw TypeError(n)};var j=(n,r,l)=>r.has(n)||S("Cannot "+l);var a=(n,r,l)=>(j(n,r,"read from private field"),l?l.call(n):r.get(n)),v=(n,r,l)=>r.has(n)?S("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(n):r.set(n,l),d=(n,r,l,s)=>(j(n,r,"write to private field"),s?s.call(n,l):r.set(n,l),l),m=(n,r,l)=>(j(n,r,"access private method"),l);var g,U,q,x,I,y,p,M,T,b,w,E,h,L,F,C,N;function l(f){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(f){for(const t in f)if(t!=="default"){const i=Object.getOwnPropertyDescriptor(f,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:()=>f[t]})}}return e.default=f,Object.freeze(e)}const s=l(r);class W{constructor(){v(this,g);this.EARTH=4007501668e-2,this.HALF_EARTH=2003750834e-2}project(e,t){return[m(this,g,U).call(this,e),m(this,g,q).call(this,t)]}unproject(e){return[m(this,g,x).call(this,e[0]),m(this,g,I).call(this,e[1])]}getID(){return"epsg:3857"}}g=new WeakSet,U=function(e){return e/180*this.HALF_EARTH},q=function(e){var t=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return t*this.HALF_EARTH/180},x=function(e){return e/this.HALF_EARTH*180},I=function(e){var t=e/this.HALF_EARTH*180;return t=180/Math.PI*(2*Math.atan(Math.exp(t*Math.PI/180))-Math.PI/2),t};class G{constructor(e,t,i={}){v(this,h);v(this,y);v(this,p);v(this,M);v(this,T);v(this,b);v(this,w);v(this,E);this.scene=e,this.camera=t,d(this,y,new W),d(this,p,{}),d(this,M,null),d(this,T,0),d(this,b,100),d(this,w,null),this.setGpsOptions(i),d(this,E,null)}setProjection(e){d(this,y,e)}setGpsOptions(e={}){e.gpsMinDistance!==void 0&&d(this,T,e.gpsMinDistance),e.gpsMinAccuracy!==void 0&&d(this,b,e.gpsMinAccuracy)}startGps(){return a(this,w)===null?(d(this,w,navigator.geolocation.watchPosition(e=>{m(this,h,C).call(this,e)},e=>{a(this,p).gpserror?a(this,p).gpserror(e.code):alert(`GPS error: code ${e.code}`)},{enableHighAccuracy:!0})),!0):!1}stopGps(){return a(this,w)!==null?(navigator.geolocation.clearWatch(a(this,w)),d(this,w,null),!0):!1}fakeGps(e,t,i=null,o=0){i!==null&&this.setElevation(i),m(this,h,C).call(this,{coords:{longitude:e,latitude:t,accuracy:o}})}lonLatToWorldCoords(e,t){const i=a(this,y).project(e,t);if(a(this,E))i[0]-=a(this,E)[0],i[1]-=a(this,E)[1];else throw"No initial position determined";return[i[0],-i[1]]}add(e,t,i,o,u={}){e.properties=u,m(this,h,L).call(this,e,t,i,o),this.scene.add(e)}setElevation(e){this.camera.position.y=e}on(e,t){a(this,p)[e]=t}}y=new WeakMap,p=new WeakMap,M=new WeakMap,T=new WeakMap,b=new WeakMap,w=new WeakMap,E=new WeakMap,h=new WeakSet,L=function(e,t,i,o){const u=this.lonLatToWorldCoords(t,i);o!==void 0&&(e.position.y=o),[e.position.x,e.position.z]=u},F=function(e,t){d(this,E,a(this,y).project(e,t))},C=function(e){let t=Number.MAX_VALUE;console.log(`#gpsReceived(): position ${e.coords.latitude},${e.coords.longitude}, accuracy ${e.coords.accuracy}, accuracy limit ${a(this,b)}`),e.coords.accuracy<=a(this,b)&&(a(this,M)===null?d(this,M,{latitude:e.coords.latitude,longitude:e.coords.longitude}):t=m(this,h,N).call(this,a(this,M),e.coords),t>=a(this,T)&&(a(this,M).longitude=e.coords.longitude,a(this,M).latitude=e.coords.latitude,this.initialPosition||m(this,h,F).call(this,e.coords.longitude,e.coords.latitude),m(this,h,L).call(this,this.camera,e.coords.longitude,e.coords.latitude),a(this,p).gpsupdate&&a(this,p).gpsupdate(e,t)))},N=function(e,t){const i=s.MathUtils.degToRad(t.longitude-e.longitude),o=s.MathUtils.degToRad(t.latitude-e.latitude),u=Math.sin(o/2)*Math.sin(o/2)+Math.cos(s.MathUtils.degToRad(e.latitude))*Math.cos(s.MathUtils.degToRad(t.latitude))*(Math.sin(i/2)*Math.sin(i/2));return 2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))*6371e3};class k{constructor(e,t,i){this.renderer=e,this.renderer.autoClear=!1,this.sceneWebcam=new s.Scene;let o;t?o=document.querySelector(t):(o=document.createElement("video"),o.setAttribute("autoplay",!0),o.setAttribute("playsinline",!0),o.style.display="none",document.body.appendChild(o)),this.geom=new s.PlaneGeometry,this.texture=new s.VideoTexture(o),this.material=new s.MeshBasicMaterial({map:this.texture});const u=new s.Mesh(this.geom,this.material);if(this.sceneWebcam.add(u),this.cameraWebcam=new s.OrthographicCamera(-.5,.5,.5,-.5,0,10),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const O={video:{width:(i==null?void 0:i.width)||1280,height:(i==null?void 0:i.height)||720,facingMode:"environment"}};navigator.mediaDevices.getUserMedia(O).then(P=>{console.log("using the webcam successfully..."),o.srcObject=P,o.play()}).catch(P=>{setTimeout(()=>{alert(`Webcam Error
Name: `+P.name+`
Message: `+P.message)},1e3)})}else setTimeout(()=>{alert("sorry - media devices API not supported")},1e3)}update(){this.renderer.clear(),this.renderer.render(this.sceneWebcam,this.cameraWebcam),this.renderer.clearDepth()}dispose(){this.material.dispose(),this.texture.dispose(),this.geom.dispose()}}const Q=new s.Vector3(0,0,1),_=new s.Euler,$=new s.Quaternion,V=new s.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),X={type:"change"};class z extends s.EventDispatcher{constructor(e){super(),window.isSecureContext===!1&&console.error("THREE.DeviceOrientationControls: DeviceOrientationEvent is only available in secure contexts (https)");const t=this,i=1e-6,o=new s.Quaternion;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0,this.deviceOrientationEventName="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";const u=function(c){t.deviceOrientation=c},O=function(){t.screenOrientation=window.orientation||0},P=function(c,A,R,D,H){_.set(R,A,-D,"YXZ"),c.setFromEuler(_),c.multiply(V),c.multiply($.setFromAxisAngle(Q,-H))};this.connect=function(){O(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(function(c){c=="granted"&&(window.addEventListener("orientationchange",O),window.addEventListener(t.deviceOrientationEventName,u))}).catch(function(c){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",c)}):(window.addEventListener("orientationchange",O),window.addEventListener(t.deviceOrientationEventName,u)),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",O),window.removeEventListener(t.deviceOrientationEventName,u),t.enabled=!1},this.update=function(){if(t.enabled===!1)return;const c=t.deviceOrientation;if(c){const A=c.alpha?s.MathUtils.degToRad(c.alpha)+t.alphaOffset:0,R=c.beta?s.MathUtils.degToRad(c.beta):0,D=c.gamma?s.MathUtils.degToRad(c.gamma):0,H=t.screenOrientation?s.MathUtils.degToRad(t.screenOrientation):0;P(t.object.quaternion,A,R,D,H),8*(1-o.dot(t.object.quaternion))>i&&(o.copy(t.object.quaternion),t.dispatchEvent(X))}},this.dispose=function(){t.disconnect()},this.connect()}}class B{constructor(e){this.raycaster=new s.Raycaster,this.normalisedMousePosition=new s.Vector2(null,null),e.domElement.addEventListener("click",t=>{this.normalisedMousePosition.set(t.clientX/e.domElement.clientWidth*2-1,-(t.clientY/e.domElement.clientHeight*2)+1)})}raycast(e,t){if(this.normalisedMousePosition.x!==null&&this.normalisedMousePosition.y!==null){this.raycaster.setFromCamera(this.normalisedMousePosition,e);const i=this.raycaster.intersectObjects(t.children,!1);return this.normalisedMousePosition.set(null,null),i}return[]}}n.ClickHandler=B,n.DeviceOrientationControls=z,n.LocationBased=G,n.SphMercProjection=W,n.WebcamRenderer=k,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
